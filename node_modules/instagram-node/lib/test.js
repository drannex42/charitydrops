var express = require('express');
var http = require('http');

var app = express();

var ig = require('./instagram.js').instagram({});
ig.use({
  access_token: '33082304.fb9cce9.cc2cf181a5024191bf0af0c0aa887462'
});

app.get('/', function(req, res, next) {
  ig.user_self_media_recent(function(err, medias, pagination, limit) {
    if(err) {
      return next(err);
    }
    else {
      return res.json(medias);
    }
  });
});

app.get('/like/:id', function(req, res, next) {
  ig.add_like(req.param('id'), {
    sign_request: {
      client_secret: 'c65203816ddb42388661356de88dadbe',
      client_req: req
    }
  }, function(err, limit) {
    if(err) {
      return next(err);
    }
    else {
      return res.send('OK!');
    }
  });
});

var http_serv = http.createServer(app).listen(8080);
console.log('Listening on port 8080...');
